
<template name="jobsView">

  <div class="panel panel-primary">
    <div class="panel-heading">
      <h3 class="panel-title">Job</h3>
    </div>
    <div class="panel-body">

      {{> jobsViewDescription}}
      {{> jobsViewHistory history=job.history}}
      {{> jobResultsLinks}}

    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Collection</h3>
    </div>
    <div class="panel-body">
      {{#if job.collection}}
        {{> jobsViewCollection collection=job.collection}}
      {{else}}
        No collection used
      {{/if}}
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Template</h3>
    </div>
    <div class="panel-body">
      {{> jobsViewTemplate template=job.template}}
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Environment variables</h3>
    </div>
    <div class="panel-body">
      {{> jobsViewEnv}}
    </div>
  </div>

</template>

<template name="jobsViewDescription">

  <table class="table table-bordered">
    <tbody>
      <tr>
        <th>Name</th>
        <td>{{job.name}}</td>
      </tr>
      <tr class="{{jobIsRunningCssClass job}}">
        <th>Status</th>
        <td>{{job.status}}</td>
      </tr>
      <tr>
        <th>Created at</th>
        <td>{{job.createdAt}}</td>
      </tr>
    </tbody>
  </table>

</template>

<template name="jobsViewHistory">
  <table class="table table-condensed table-striped table-bordered">
  <thead>
    <tr>
      <th>Status</th>
      <th>At</th>
    </tr>
  </thead>
  <tbody>
    {{#each history}}
    <tr>
      <td>{{status}} {{#if comment}}<br>{{comment}}{{/if}}</td>
      <td>{{at}}</td>
    </tr>
    {{/each}}
  </tbody>
</table>

</template>

<template name="jobsViewEnv">
  <table class="table table-condensed table-striped table-bordered">
    <thead>
      <tr>
        <th>Key</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      {{#each job.env}}
      <tr>
        <td>{{key}}</td>
        <td>{{value}}</td>
      </tr>
      {{/each}}
    </tbody>
  </table>
</template>

<template name="jobsViewTemplate">

  <table class="table table-bordered">
    <tbody>
      <tr>
        <th>Original template</th>
        <td><a href="{{pathFor 'templates.edit' _id=template._id}}">{{template.name}}</a></td>
      </tr>
      <tr>
        <th>Created at</th>
        <td>{{template.createdAt}}</td>
      </tr>
      <tr>
        <th>Last update</th>
        <td>{{template.updatedAt}}</td>
      </tr>
    </tbody>
  </table>

  <div class="panel-group" id="template-code-container" role="tablist" aria-multiselectable="true">
    <div class="panel panel-warning">
      <div class="panel-heading" role="tab" id="headingOne">
        <a role="button" data-toggle="collapse" data-parent="#template-code-container" href="#template-code" aria-expanded="false" aria-controls="collapseOne">
          View full code
        </a>
      </div>
      <div id="template-code" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
        <div class="panel-body">
          <pre>{{jsonPretty template.code}}</pre>
        </div>
      </div>
    </div>
  </div>

</template>

<template name="jobsViewCollection">

  <table class="table table-bordered">
    <tbody>
      <tr>
        <th>Original collection</th>
        <td><a href="{{pathFor 'collections.edit' _id=collection._id}}">{{collection.name}}</a></td>
      </tr>
      <tr>
        <th>Created at</th>
        <td>{{collection.createdAt}}</td>
      </tr>
      <tr>
        <th>Last update</th>
        <td>{{collection.updatedAt}}</td>
      </tr>
      <tr>
        <th>Length</th>
        <td>{{length collection.parameters}}</td>
      </tr>
    </tbody>
  </table>

  <div class="panel-group" id="collection-listing" role="tablist" aria-multiselectable="true">
    <div class="panel panel-warning">
      <div class="panel-heading" role="tab" id="headingOne">
        <a role="button" data-toggle="collapse" data-parent="#collection-listing" href="#collection-list" aria-expanded="false" aria-controls="collapseOne">
          View full list of parameters
        </a>
      </div>
      <div id="collection-list" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
        <div class="panel-body">
          <pre>{{jsonPretty collection.parameters}}</pre>
        </div>
      </div>
    </div>
  </div>

</template>
